@{
    ViewBag.Title = "ThanhToanOff";
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
}
<style>
    body {
        background-color: #f8f9fa;
    }

    .form-container {
        margin-bottom: 50px;
        padding: 30px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #ffffff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    .payment-option {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }

        .payment-option i {
            margin-right: 10px;
            font-size: 20px;
        }

    .address-container {
        display: none; /* Initially hide address inputs */
    }

    .payment-option {
        cursor: pointer; /* Change cursor to pointer for better UX */
    }

        .payment-option:hover .form-check-input {
            outline: 2px solid #007bff; /* Change outline on hover for the radio button */
        }

    .payment-icon {
        width: 30px; /* Adjust the width of the icons */
        height: 30px; /* Adjust the height of the icons */
        transition: transform 0.2s; /* Transition effect for the hover */
    }

    .payment-option:hover .payment-icon {
        transform: scale(1.1); /* Scale up icon on hover */
    }

    .form-check-input:checked + .form-check-label .payment-icon {
        border: 2px solid #007bff; /* Optional: add border to selected icons */
        border-radius: 50%; /* Optional: round the border */
    }

    .visually-hidden {
        position: absolute; /* Position the radio button off-screen */
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        border: 0;
        overflow: hidden;
        clip: rect(0, 0, 0, 0); /* Hide the radio button visually */
        white-space: nowrap; /* Prevent line breaks */
    }
</style>

<div class="container form-container">
    <h2 class="text-center">Thanh Toán Đơn Hàng</h2>


    <form id="paymentForm" method="post" action="/Pay/ThanhToan">
        <div class="mb-3">
            <label for="customerName" class="form-label">Tên Khách Hàng</label>
            <input type="text" class="form-control" id="HoTen" name="HoTen" placeholder="Nhập tên khách hàng" value="@(Session["Name"] != null ? Model.HoTen : "")" required>
        </div>
        <div class="mb-3">
            <label for="customerPhone" class="form-label">Số Điện Thoại</label>
            <input type="text"
                   class="form-control"
                   id="SDT"
                   name="SDT"
                   placeholder="Nhập số điện thoại"
                   value="@(Session["Name"] != null ? Model.SDT : "")"
                   pattern="^0\d{9}$" 
                    maxlength="10"
                    required>
            <span id="errorMessage" style="color: red; display: none;">Số điện thoại phải bắt đầu bằng số 0 và có đúng 10 chữ số!</span>
        </div>

        <script>
            document.getElementById("SDT").addEventListener("input", function (e) {
                const input = e.target.value;
                const errorMessage = document.getElementById("errorMessage");
                const regex = /^0\d{0,9}$/; // Bắt đầu bằng 0 và không vượt quá 10 số

                if (!regex.test(input)) {
                    errorMessage.style.display = "block";
                } else if (input.length === 10) {
                    errorMessage.style.display = "none"; // Ẩn lỗi khi đủ điều kiện
                } else {
                    errorMessage.style.display = "none";
                }
            });
        </script>

        <div class="mb-3 d-flex align-items-center">
            <span class="form-label me-3" style="padding-right:25px">Hình Thức Nhận Hàng</span>
            <div class="d-flex align-items-center">
                <div class="payment-option me-3" style="padding-right:25px">
                    <input class="form-check-input" type="radio" name="deliveryMethod" id="homeDelivery" value="home" required>
                    <label class="form-check-label" for="homeDelivery">
                        Nhận Hàng Tại Nhà
                    </label>
                </div>
                <div class="payment-option">
                    <input class="form-check-input" type="radio" name="deliveryMethod" id="pharmacyPickup" value="pharmacy" required>
                    <label class="form-check-label" for="pharmacyPickup">
                        Nhận Hàng Tại Quầy Thuốc
                    </label>
                </div>
            </div>
        </div>




        <div class="row mb-3 address-container" id="addressFields">
            <div class="col-md-12">
                <label for="tinh" class="form-label">Tỉnh Thành</label>
                <select class="form-select" id="tinh" name="TinhThanh">
                    <option value="@(Session["Name"] != null ? Model.TinhThanh : "")">@(Session["Name"] != null ? Model.TinhThanh : "Chọn Tỉnh Thành")</option>
                </select>
            </div>
            <div class="col-md-12">
                <label for="quan" class="form-label">Quận Huyện</label>
                <select class="form-select" id="quan" name="QuanHuyen">
                    <option value="@(Session["Name"] != null ? Model.QuanHuyen : "")">@(Session["Name"] != null ? Model.QuanHuyen : "Chọn Quận Huyện")</option>
                </select>
            </div>
            <div class="col-md-12">
                <label for="phuong" class="form-label">Phường Xã</label>
                <select class="form-select" id="phuong" name="PhuongXa">
                    <option value="@(Session["Name"] != null ? Model.PhuongXa : "")">@(Session["Name"] != null ? Model.PhuongXa : "Chọn Phường Xã")</option>
                </select>
            </div>
            <div class="mb-3">
                <label for="soNha" class="form-label">Số Nhà / Địa Chỉ</label>
                <input type="text" class="form-control" id="soNha" name="DiaChiNhanHang" placeholder="Nhập số nhà và tên đường" value="@(Session["Name"] != null ? Model.DiaChi : "")">
            </div>

        </div>

        <div class="mb-3 address-container" id="customAddressFields" style="display:none;">
            <label for="pharmacyAddress" class="form-label">Chọn Địa Chỉ Quầy Thuốc</label>
            <select class="form-select" id="pharmacyAddress" name="pharmacyAddress">
                <option value="">Chọn Địa Chỉ Quầy Thuốc</option>
                <option>285 Bạch Đằng, P.3, Gò Vấp, HCM</option>
                <option>354 Nguyễn Văn Công, P.3, Gò Vấp, HCM </option>
            </select>
        </div>


        <div class="mb-3">
            <label for="totalAmount" class="form-label">Tổng Số Tiền</label>
            <input type="text" class="form-control" id="totalAmount" name="TongTien" value="@String.Format("{0:N0}", ViewBag.TotalAmount)" required readonly />

        </div>

        <div class="mb-3">
            <label class="form-label">Phương Thức Thanh Toán</label>
            <div class="d-flex">
                <div class="payment-option me-3" style=" padding-right:30px">
                    <input class="form-check-input visually-hidden" type="radio" name="paymentMethod" id="vnpay" value="vnpay" required>
                    <label class="form-check-label d-flex align-items-center" for="vnpay">
                        <img src="~/Assets/Image/vnpay.png" alt="Ví VNPay" class="payment-icon me-2" style="width:80px; height:auto">VNPAY
                    </label>
                </div>
                <div class="payment-option me-3" style=" padding-right:30px">
                    <input class="form-check-input visually-hidden" type="radio" name="paymentMethod" id="momo" value="momo">
                    <label class="form-check-label d-flex align-items-center" for="momo">
                        <img src="~/Assets/Image/momo.jpg" alt="Ví điện tử Momo" class="payment-icon me-2" style="width:80px; height:auto">MOMO
                    </label>
                </div>
                <div class="payment-option me-3" style=" padding-right:30px">
                    <input class="form-check-input visually-hidden" type="radio" name="paymentMethod" id="vietcombank" value="vietcombank">
                    <label class="form-check-label d-flex align-items-center" for="vietcombank">
                        <img src="~/Assets/Image/VCB.jpg" alt="Ngân Hàng Vietcombank" class="payment-icon me-2" style="width:80px; height:auto">VIETCOMBANK
                    </label>
                </div>
                <div class="payment-option me-3" style=" padding-right:30px">
                    <input class="form-check-input visually-hidden" type="radio" name="paymentMethod" id="tpbank" value="tpbank">
                    <label class="form-check-label d-flex align-items-center" for="tpbank">
                        <img src="~/Assets/Image/tpbank.jpg" alt="Ngân Hàng TPBank" class="payment-icon me-2" style="width:80px; height:auto">TPBANK
                    </label>
                </div>
                <div class="payment-option" style=" padding-right:30px">
                    <input class="form-check-input visually-hidden" type="radio" name="paymentMethod" id="cash" value="cash">
                    <label class="form-check-label d-flex align-items-center" for="cash">
                        <img src="~/Assets/Image/tienmat.png" alt="Thanh Toán Khi Nhận Hàng" class="payment-icon me-2" style="width:80px; height:auto;">THANH TOÁN KHI NHẬN HÀNG
                    </label>
                </div>
            </div>
        </div>



        <div class="text-center">
            <button type="submit" class="btn btn-primary">Xác Nhận Đặt Hàng</button>
        </div>
    </form>
</div>

<script src="https://esgoo.net/scripts/jquery.js"></script>
<script>
    $(document).ready(function () {
        // Load provinces
        $.getJSON('https://esgoo.net/api-tinhthanh/1/0.htm', function (data_tinh) {
            if (data_tinh.error == 0) {
                $.each(data_tinh.data, function (key_tinh, val_tinh) {
                    // Gán ID vào thuộc tính data-id của thẻ <option>
                    $("#tinh").append('<option value="' + val_tinh.full_name + '" data-id="' + val_tinh.id + '">' + val_tinh.full_name + '</option>');
                });

                $("#tinh").change(function () {
                    // Lấy ID tỉnh đã chọn từ data-id
                    var idtinh = $(this).find('option:selected').data('id');
                    console.log("ID tỉnh đã chọn: " + idtinh); // Kiểm tra ID tỉnh

                    // Load districts
                    $.getJSON('https://esgoo.net/api-tinhthanh/2/' + idtinh + '.htm', function (data_quan) {
                        if (data_quan.error == 0) {
                            $("#quan").html('<option value="">Chọn Quận Huyện</option>');
                            $("#phuong").html('<option value="">Chọn Phường Xã</option>');
                            $.each(data_quan.data, function (key_quan, val_quan) {
                                // Gán ID quận vào thuộc tính data-id của thẻ <option>
                                $("#quan").append('<option value="' + val_quan.full_name + '" data-id="' + val_quan.id + '">' + val_quan.full_name + '</option>');
                            });

                            // Load wards
                            $("#quan").change(function () {
                                // Lấy ID quận đã chọn từ data-id
                                var idquan = $(this).find('option:selected').data('id');
                                console.log("ID quận đã chọn: " + idquan); // Kiểm tra ID quận

                                $.getJSON('https://esgoo.net/api-tinhthanh/3/' + idquan + '.htm', function (data_phuong) {
                                    if (data_phuong.error == 0) {
                                        $("#phuong").html('<option value="">Chọn Phường Xã</option>');
                                        $.each(data_phuong.data, function (key_phuong, val_phuong) {
                                            // Gán ID phường vào thuộc tính data-id của thẻ <option>
                                            $("#phuong").append('<option value="' + val_phuong.full_name + '" data-id="' + val_phuong.id + '">' + val_phuong.full_name + '</option>');
                                        });
                                    }
                                });
                            });
                        }
                    });
                });
            }
        });

        // Show/hide address fields based on delivery method
        $('input[name="deliveryMethod"]').change(function () {
            if ($(this).val() === 'home') {
                $('#addressFields').show();
                $('#customAddressFields').hide();
                // Optionally reset pharmacy selection
                $('#pharmacyAddress').val('');
            } else if ($(this).val() === 'pharmacy') {
                $('#addressFields').hide();
                $('#customAddressFields').show();
                // Optionally reset address selection
                $('#tinh').val('');
                $('#quan').val('');
                $('#phuong').val('');
                $('#soNha').val('');
            }
        });

        // Validate form submission
        $('form').submit(function (event) {
            let isValid = true;

            // If home delivery is selected, ensure all home address fields are filled
            if ($('input[name="deliveryMethod"]:checked').val() === 'home') {
                if (!$('#tinh').val().trim()) {
                    alert('Vui lòng chọn tỉnh thành!');
                    isValid = false;
                }
                if (!$('#quan').val().trim()) {
                    alert('Vui lòng chọn quận huyện!');
                    isValid = false;
                }
                if (!$('#phuong').val().trim()) {
                    alert('Vui lòng chọn phường xã!');
                    isValid = false;
                }
                if (!$('#soNha').val().trim()) {
                    alert('Vui lòng nhập địa chỉ nhận hàng!');
                    isValid = false;
                }
            }

            // If pharmacy pickup is selected, ensure pharmacy address is selected
            if ($('input[name="deliveryMethod"]:checked').val() === 'pharmacy') {
                if (!$('#pharmacyAddress').val().trim()) {
                    alert('Vui lòng chọn địa chỉ quầy thuốc!');
                    isValid = false;
                }
            }

            // Prevent form submission if validation fails
            if (!isValid) {
                event.preventDefault();
            }
        });

    });

</script>

